function E(l,t){if(l.parentElement===null)throw Error("`elem` has no parentElement");return l.parentElement.insertBefore(t,l),t.appendChild(l),l}function S(l,t,e){const n=[];for(;l&&l.parentElement!==null&&(e===void 0||n.length<e);)l instanceof HTMLElement&&l.matches(t)&&n.push(l),l=l.parentElement;return n}function m(l,t){const e=S(l,t,1);return e.length?e[0]:null}function A(l){if(!l)throw new Error("Element is not defined");return l.getBoundingClientRect().top}const f={backLinkAfter:"",backLinkBefore:"",showBackLink:!0,keyClose:"Escape",keyOpen:"",position:"right",submenuLinkAfter:"",submenuLinkBefore:"",closeOnClickOutside:!1,onlyNavigateDecorator:!1,minWidthFold:640,transitionDuration:300,alignFoldTop:!1},s=class s{constructor(t,e){if(this.level=0,this.foldLevel=0,this.activeSubmenu=null,this.lastFocusedElement=null,this.isOpen=!1,this.isAnimating=!1,this.lastAction=null,t===null)throw new Error("Argument `elem` must be a valid HTML node");this.options=Object.assign({},f,e),this.menuElem=t,this.wrapperElem=document.createElement("div"),this.wrapperElem.classList.add(s.CLASS_NAMES.wrapper);const n=this.menuElem.querySelector("ul");n&&E(n,this.wrapperElem),this.initMenu(),this.initSubmenus(),this.initEventHandlers(),this.menuElem._slideMenu=this}toggle(t,e=!0){var i,o;let n;if(t===void 0){this.isOpen?this.close(e):this.open(e);return}else t?(n=0,this.lastFocusedElement=document.activeElement,this.focusFirstElemInSubmenu(this.activeSubmenu)):(n=this.options.position==="left"?"-100%":"100%",this.menuElem.querySelectorAll("."+s.CLASS_NAMES.foldableSubmenu).forEach(a=>{a.classList.remove(s.CLASS_NAMES.active)}),this.menuElem.classList.remove(s.CLASS_NAMES.foldOpen),this.foldLevel=0,(i=this.lastFocusedElement)==null||i.focus(),(o=this.lastFocusedElement)==null||o.scrollIntoView({behavior:"smooth"}));if(this.isOpen=t,e)this.moveSlider(this.menuElem,n);else{const a=this.moveSlider.bind(this,this.menuElem,n);this.runWithoutAnimation(a)}}open(t=!0){this.triggerEvent("open"),this.toggle(!0,t)}close(t=!0){this.triggerEvent("close"),this.toggle(!1,t)}back(){this.navigate(-1)}navigateTo(t){if(this.triggerEvent("navigate"),this.isOpen||this.open(),typeof t=="string"){const o=document.querySelector(t);if(o instanceof HTMLElement)t=o;else throw new Error("Invalid parameter `target`. A valid query selector is required.")}Array.from(this.wrapperElem.querySelectorAll(`.${s.CLASS_NAMES.active}`)).forEach(o=>{o.classList.remove(s.CLASS_NAMES.active)});const n=S(t,"ul"),i=n.length-1;i>=0&&i!==this.level&&(this.level=i,this.moveSlider(this.wrapperElem,-this.level*100)),n.forEach(o=>{o.classList.add(s.CLASS_NAMES.active)}),this.activeSubmenu=this.getParentSubmenuOfAnchor(t),setTimeout(()=>{t.focus()},this.options.transitionDuration)}initEventHandlers(){if(this.options.onlyNavigateDecorator){const t=Array.from(this.menuElem.querySelectorAll("."+s.CLASS_NAMES.decorator)),e=n=>{var a;const i=n.target,o=(a=i==null?void 0:i.parentElement)!=null&&a.matches("a")?i==null?void 0:i.parentElement:m(i==null?void 0:i.parentElement,"a");o&&!i.dataset.action&&this.navigate(1,o)};t.forEach(n=>{n.addEventListener("click",e),n.addEventListener("keydown",i=>{i.key==="Enter"&&e(i)})})}else Array.from(this.menuElem.querySelectorAll("a")).forEach(e=>{e.addEventListener("click",n=>{const i=n.target,o=i.matches("a")?i:m(i,"a");o&&!i.dataset.action&&this.navigate(1,o)})});this.menuElem.addEventListener("transitionend",this.onTransitionEnd.bind(this)),this.wrapperElem.addEventListener("transitionend",this.onTransitionEnd.bind(this)),this.options.closeOnClickOutside&&document.addEventListener("click",t=>{this.isOpen&&!this.isAnimating&&!this.menuElem.contains(t.target)&&this.close()}),this.initKeybindings(),this.initSubmenuVisibility()}onTransitionEnd(t){t.target!==this.menuElem&&t.target!==this.wrapperElem||(this.isAnimating=!1,this.lastAction&&(this.triggerEvent(this.lastAction,!0),this.lastAction=null))}initKeybindings(){document.addEventListener("keydown",t=>{switch(t.key){case this.options.keyClose:this.close();break;case this.options.keyOpen:this.open();break;default:return}t.preventDefault()})}initSubmenuVisibility(){this.menuElem.addEventListener("sm.back-after",()=>{const t=`.${s.CLASS_NAMES.active} `.repeat(this.level+1),e=this.menuElem.querySelector(`ul ${t}`);e&&e.classList.remove(s.CLASS_NAMES.active)})}triggerEvent(t,e=!1){this.lastAction=t;const n=`sm.${t}${e?"-after":""}`,i=new CustomEvent(n);this.menuElem.dispatchEvent(i)}navigate(t=1,e){var r;if(this.isAnimating||t===-1&&this.level===0)return;const n=(this.level+t)*-100,i=window.innerWidth>=this.options.minWidthFold&&((e==null?void 0:e.classList.contains(s.CLASS_NAMES.hasFoldableSubmenu))??this.foldLevel>0);this.menuElem.classList.remove(s.CLASS_NAMES.foldOpen);const o=this.getNextSubmenu(e),a=this.getPreviousSubmenu(this.activeSubmenu);e&&o&&t===1?(this.activeSubmenu=o,this.markSelectedItem(e),i?this.positionFoldableSubmenu(o):o.style.left="100%"):a&&t===-1&&(this.activeSubmenu=a),this.setTabIndex(this.activeSubmenu,i),(r=this.activeSubmenu)==null||r.classList.add(s.CLASS_NAMES.active);const h=t===1?"forward":"back";this.triggerEvent(h),i?(this.foldLevel+=t,this.foldLevel>0&&this.menuElem.classList.add(s.CLASS_NAMES.foldOpen)):(this.level+=t,this.moveSlider(this.wrapperElem,n)),setTimeout(()=>{var u;this.focusFirstElemInSubmenu(this.activeSubmenu),(u=this.activeSubmenu)==null||u.querySelectorAll("."+s.CLASS_NAMES.active).forEach(d=>{d.classList.remove(s.CLASS_NAMES.active)})},this.options.transitionDuration)}getParentSubmenuOfAnchor(t){return t.closest("ul")}getPreviousSubmenu(t){var e;return(e=t==null?void 0:t.parentElement)==null?void 0:e.closest("ul")}getNextSubmenu(t){var e;return(e=t==null?void 0:t.parentElement)==null?void 0:e.querySelector("ul")}markSelectedItem(t){this.menuElem.querySelectorAll("."+s.CLASS_NAMES.activeItem).forEach(e=>{e.classList.remove(s.CLASS_NAMES.activeItem)}),t.classList.add(s.CLASS_NAMES.activeItem)}setTabIndex(t,e){const n=`a, .${s.CLASS_NAMES.decorator}[tabindex]`;if(!e&&t){const i=this.getPreviousSubmenu(t);i==null||i.querySelectorAll(n).forEach(o=>{o.setAttribute("tabindex","-1")})}t==null||t.querySelectorAll(n).forEach(i=>{i.setAttribute("tabindex","0")})}focusFirstElemInSubmenu(t){var n;(n=t==null?void 0:t.querySelector('a[href][tabindex]:not([tabindex="-1"])'))==null||n.focus()}positionFoldableSubmenu(t){t.style.left=this.options.position==="left"?"100%":"-100%";const e=A(t);this.options.alignFoldTop&&e>0&&(t.style.top=`-${e}px`,t.classList.add(s.CLASS_NAMES.foldableSubmenuAlignTop))}moveSlider(t,e){e.toString().includes("%")||(e+="%"),t.style.transform=`translateX(${e})`,this.isAnimating=!0}initMenu(){this.runWithoutAnimation(()=>{switch(this.options.position){case"left":Object.assign(this.menuElem.style,{left:0,right:"auto",transform:"translateX(-100%)"});break;default:Object.assign(this.menuElem.style,{left:"auto",right:0});break}this.menuElem.style.display="block",this.menuElem.querySelectorAll("a").forEach(t=>{t.classList.add(s.CLASS_NAMES.item),t.setAttribute("tabindex","0")})})}runWithoutAnimation(t){const e=[this.menuElem,this.wrapperElem];e.forEach(n=>n.style.transition="none"),t(),this.menuElem.offsetHeight,e.forEach(n=>n.style.removeProperty("transition")),this.isAnimating=!1}initSubmenus(){this.menuElem.querySelectorAll("a").forEach(t=>{var o;if(t.parentElement===null)return;const e=t.parentElement.querySelector("ul");if(!e)return;const n=t.textContent;if(this.addLinkDecorators(t),t.classList.add(s.CLASS_NAMES.hasSubMenu),e.classList.add(s.CLASS_NAMES.submenu),t.classList.contains(s.CLASS_NAMES.hasFoldableSubmenu)&&e.classList.add(s.CLASS_NAMES.foldableSubmenu),this.options.onlyNavigateDecorator?(o=t.querySelector("."+s.CLASS_NAMES.decorator))==null||o.addEventListener("click",a=>{a.preventDefault()}):t.addEventListener("click",a=>{a.preventDefault()}),this.options.showBackLink){const{backLinkBefore:a,backLinkAfter:h}=this.options,r=document.createElement("a");r.innerHTML=a+n+h,r.classList.add(s.CLASS_NAMES.backlink,s.CLASS_NAMES.control,s.CLASS_NAMES.item),r.setAttribute("data-action","back"),r.setAttribute("tabindex","0"),r.setAttribute("href","#");const u=document.createElement("li");u.appendChild(r),e.insertBefore(u,e.firstChild)}}),this.activeSubmenu=this.menuElem.querySelector("ul")}addLinkDecorators(t){const{submenuLinkBefore:e,submenuLinkAfter:n}=this.options;if(e){const i=document.createElement("span");i.classList.add(s.CLASS_NAMES.decorator),i.innerHTML=e,this.options.onlyNavigateDecorator&&i.setAttribute("tabindex","0"),t.insertBefore(i,t.firstChild)}if(n){const i=document.createElement("span");i.classList.add(s.CLASS_NAMES.decorator),i.innerHTML=n,this.options.onlyNavigateDecorator&&i.setAttribute("tabindex","0"),t.appendChild(i)}return t}};s.NAMESPACE="slide-menu",s.CLASS_NAMES={active:`${s.NAMESPACE}__submenu--active`,backlink:`${s.NAMESPACE}__backlink`,control:`${s.NAMESPACE}__control`,decorator:`${s.NAMESPACE}__decorator`,wrapper:`${s.NAMESPACE}__slider`,item:`${s.NAMESPACE}__item`,submenu:`${s.NAMESPACE}__submenu`,hasSubMenu:`${s.NAMESPACE}__item--has-submenu`,activeItem:`${s.NAMESPACE}__item--active`,hasFoldableSubmenu:`${s.NAMESPACE}__item--has-foldable-submenu`,foldableSubmenu:`${s.NAMESPACE}__submenu--foldable`,foldableSubmenuAlignTop:`${s.NAMESPACE}__submenu--foldable-align-top`,foldOpen:`${s.NAMESPACE}--fold-open`};let c=s;document.addEventListener("click",l=>{if(!(l.target instanceof HTMLElement))return;const t=l.target.className.includes(c.CLASS_NAMES.control)?l.target:m(l.target,`.${c.CLASS_NAMES.control}`);if(!t||!t.className.includes(c.CLASS_NAMES.control))return;const e=t.getAttribute("data-target"),n=!e||e==="this"?m(t,`.${c.NAMESPACE}`):document.getElementById(e);if(!n)throw new Error(`Unable to find menu ${e}`);const i=n._slideMenu,o=t.getAttribute("data-action"),a=t.getAttribute("data-arg");i&&o&&typeof i[o]=="function"&&(a?i[o](a):i[o]())});window.SlideMenu=c;
