var E=(s=>(s.Left="left",s.Right="right",s))(E||{}),u=(s=>(s.Back="back",s.Close="close",s.Forward="forward",s.Navigate="navigate",s.NavigateTo="navigateTo",s.Open="open",s))(u||{});const d="slide-menu",r={active:`${d}__submenu--active`,backlink:`${d}__backlink`,control:`${d}__control`,controls:`${d}__controls`,decorator:`${d}__decorator`,slider:`${d}__slider`,item:`${d}__item`,submenu:`${d}__submenu`,sliderWrapper:`${d}__slider__wrapper`,foldableWrapper:`${d}__foldable__wrapper`,hasSubMenu:`${d}__item--has-submenu`,activeItem:`${d}__item--active`,hasFoldableSubmenu:`${d}__item--has-foldable-submenu`,foldableSubmenu:`${d}__submenu--foldable`,foldableSubmenuAlignTop:`${d}__submenu--foldable-align-top`,foldOpen:`${d}--fold-open`,slideIn:`${d}--slide-in`,slideOut:`${d}--slide-out`,left:`${d}--left`,right:`${d}--right`};function y(s,t,i){const e=[];for(;s&&s.parentElement!==null&&e.length<i;)s instanceof HTMLElement&&s.matches(t)&&e.push(s),s=s.parentElement;return e}function T(s,t){const i=y(s,t,1);return i.length?i[0]:null}const b='a[href]:not([disabled]), button:not([disabled]), textarea:not([disabled]), input[type="text"]:not([disabled]), input[type="radio"]:not([disabled]), input[type="checkbox"]:not([disabled]), select:not([disabled]), [tabindex]:not([tabindex="-1"]):not([disabled])';function A(s){var t;(t=s==null?void 0:s.querySelector(b))==null||t.focus()}function S(s,t,i,e){const l=t.querySelectorAll(b),n=i??l[0],a=l[l.length-1];(s.key==="Tab"||s.keyCode===9)&&(s.shiftKey?document.activeElement===n&&(a.focus(),s.preventDefault()):document.activeElement===a&&(n.focus(),s.preventDefault()))}let g=0;class p{constructor(t,i,e){var l,n,a;this.menuElem=t,this.options=i,this.anchorElem=e,this.isFoldable=!1,this.active=!1,this.id="smdm-"+g,g++,this.name=((l=this.anchorElem)==null?void 0:l.textContent)??"",this.parentMenuElem=((n=e==null?void 0:e.parentElement)==null?void 0:n.closest("ul"))??void 0,this.parent=(a=this.parentMenuElem)==null?void 0:a._slide,e&&(e==null||e.classList.add(r.hasSubMenu),e.dataset.action=u.NavigateTo,e.dataset.target=this.options.id,e.dataset.arg=this.id),t.classList.add(r.submenu),t.dataset.smdmId=this.id,t.querySelectorAll("a").forEach(c=>{c.classList.add(r.item)}),this.isFoldable=!!(e!=null&&e.classList.contains(r.hasFoldableSubmenu)),this.isFoldable&&t.classList.add(r.foldableSubmenu),i.showBackLink&&this.addBackLink(i),this.addLinkDecorator(i),t._slide=this}get isActive(){return this.active}addBackLink(t=this.options){var n;const i=((n=this.anchorElem)==null?void 0:n.textContent)??"",e=document.createElement("a");e.innerHTML=(t.backLinkBefore??"")+i+(t.backLinkAfter??""),e.classList.add(r.backlink,r.control,r.item),e.dataset.action=u.Back,e.setAttribute("href","#");const l=document.createElement("li");return l.appendChild(e),this.menuElem.insertBefore(l,this.menuElem.firstChild),e}addLinkDecorator(t=this.options){var e,l,n;const i="span";if(t.submenuLinkBefore){const a=document.createElement(i);a.classList.add(r.decorator),a.innerHTML=t.submenuLinkBefore,a.dataset.action=u.NavigateTo,a.dataset.target=this.options.id,a.dataset.arg=this.id,(l=this.anchorElem)==null||l.insertBefore(a,(e=this.anchorElem)==null?void 0:e.firstChild)}if(t.submenuLinkAfter){const a=document.createElement(i);a.classList.add(r.decorator),a.innerHTML=t.submenuLinkAfter,a.dataset.action=u.NavigateTo,a.dataset.target=this.options.id,a.dataset.arg=this.id,(n=this.anchorElem)==null||n.appendChild(a)}return this.anchorElem}deactivate(){return this.active=!1,this.menuElem.classList.remove(r.active),this}activate(){return this.active=!0,this.menuElem.classList.add(r.active),this}enableTabbing(){var t;(t=this.menuElem)==null||t.querySelectorAll('[tabindex="-1"]').forEach(i=>{i.setAttribute("tabindex","0")})}disableTabbing(){this.menuElem.querySelectorAll(b).forEach(t=>{t.setAttribute("tabindex","-1")})}appendTo(t){return t.appendChild(this.menuElem),this}postionTop(t){return this.menuElem.style.top=t+"px",this}getClosestNotFoldableSlide(){return this.getAllParents().find(t=>!t.isFoldable)}getAllParents(){const t=[];let i=this.parent;for(;i;)t.push(i),i=i==null?void 0:i.parent;return t}focusFirstElem(){A(this.menuElem)}canFold(){return this.isFoldable&&window.innerWidth>=this.options.minWidthFold}matches(t){var i,e,l;return this.id===t||this.menuElem.id===t||((i=this.anchorElem)==null?void 0:i.id)===t||((e=this.anchorElem)==null?void 0:e.href)===t||((l=this.anchorElem)==null?void 0:l.matches(t))||this.menuElem.matches(t)}contains(t){return this.anchorElem===t||this.menuElem.contains(t)}focus(){this.focusFirstElem()}}const _={backLinkAfter:"",backLinkBefore:"",showBackLink:!0,keyClose:"Escape",keyOpen:"",position:"right",submenuLinkAfter:"",submenuLinkBefore:"",closeOnClickOutside:!1,onlyNavigateDecorator:!1,menuWidth:320,minWidthFold:640,transitionDuration:300,dynamicOpenTarget:!1,id:""};let v=0;class F{constructor(t,i){if(this.lastFocusedElement=null,this.isOpen=!1,this.isAnimating=!1,this.lastAction=null,this.slides=[],t===null)throw new Error("Argument `elem` must be a valid HTML node");for(this.options=Object.assign({},_,i),this.menuElem=t,this.options.id=this.menuElem.id??"smdm-slide-menu-"+v,v++,this.menuElem.id=this.options.id,document.documentElement.style.setProperty("--smdm-sm-menu-width",`${this.options.menuWidth}px`),document.documentElement.style.setProperty("--smdm-sm-min-width-fold",`${this.options.minWidthFold}px`),document.documentElement.style.setProperty("--smdm-sm-transition-duration",`${this.options.transitionDuration}ms`),this.sliderElem=document.createElement("div"),this.sliderElem.classList.add(r.slider);this.menuElem.firstChild;)this.sliderElem.appendChild(this.menuElem.firstChild);this.menuElem.appendChild(this.sliderElem),this.sliderWrapperElem=document.createElement("div"),this.sliderWrapperElem.classList.add(r.sliderWrapper),this.sliderElem.appendChild(this.sliderWrapperElem),this.foldableWrapperElem=document.createElement("div"),this.foldableWrapperElem.classList.add(r.foldableWrapper),this.sliderElem.after(this.foldableWrapperElem),this.initMenu(),this.initSlides(),this.initEventHandlers(),this.menuElem._slideMenu=this}toggleVisibility(t,i=!0){var l;let e;if(t===void 0){this.isOpen?this.close(i):this.show(i);return}t?(e=0,this.lastFocusedElement=document.activeElement,(l=this.activeSubmenu)==null||l.focusFirstElem()):(e=this.options.position===E.Left?"-100%":"100%",setTimeout(()=>{var n;this.slides.forEach(a=>!a.isActive&&a.deactivate()),(n=this.lastFocusedElement)==null||n.focus(),this.menuElem.classList.remove(r.foldOpen)},this.options.transitionDuration)),this.isOpen=!!t,this.moveElem(this.menuElem,e)}toggle(t=!0){if(this.isOpen){this.close(t);return}this.open(t)}show(t=!0){this.triggerEvent(u.Open),this.toggleVisibility(!0,t)}close(t=!0){this.triggerEvent(u.Close),this.toggleVisibility(!1,t)}back(t=!1){var e,l,n;let i=((e=this.activeSubmenu)==null?void 0:e.parent)??this.slides[0];t&&(this.closeFold(),i=((n=(l=this.activeSubmenu)==null?void 0:l.getClosestNotFoldableSlide())==null?void 0:n.parent)??this.slides[0]),this.navigateTo(i)}closeFold(){this.slides.forEach(t=>{t.appendTo(this.sliderWrapperElem)}),this.menuElem.classList.remove(r.foldOpen)}openFold(){this.slides.forEach(t=>{t.isFoldable&&t.appendTo(this.foldableWrapperElem)}),this.menuElem.classList.add(r.foldOpen)}navigateTo(t){this.triggerEvent(u.NavigateTo);let i;if(this.isOpen||this.show(),typeof t=="string"){const o=this.getTargetMenuFromIdentifier(t);if(o instanceof p)i=o;else throw new Error("Invalid parameter `target`. A valid query selector is required.")}if(t instanceof HTMLElement){const o=this.slides.find(k=>k.contains(t));if(o instanceof p)i=o;else throw new Error("Invalid parameter `target`. Not found in slide menu")}if(t instanceof p&&(i=t),!i)throw new Error("No valid next slide fund");const e=this.activeSubmenu,l=i.getAllParents(),n=l.find(o=>!o.canFold()),a=[i,...l],c=a.map(o=>o==null?void 0:o.id),h=e==null?void 0:e.getAllParents().map(o=>o.id).includes(i.id);i.canFold()?(this.openFold(),n==null||n.getAllParents().forEach(o=>{o.disableTabbing()})):e!=null&&e.canFold()&&!i.canFold()&&(this.closeFold(),l.forEach(o=>{o.disableTabbing()})),console.log(h),console.log(e,e==null?void 0:e.isActive,e==null?void 0:e.menuElem.classList.toString()),this.slides.forEach(o=>{if(!c.includes(o.id)){if(h&&o.id===(e==null?void 0:e.id))return;o.deactivate(),o.disableTabbing()}}),console.log(e,e==null?void 0:e.isActive,e==null?void 0:e.menuElem.classList.toString()),a.forEach(o=>{o!=null&&o.isActive||o==null||o.activate()}),i.enableTabbing();const m=Math.max(1,this.getSlideLevel())-1-(i.canFold()?0:Number(h)),f=this.options.menuWidth,L=this.options.position===E.Left?-f*m:f*m;this.moveElem(this.sliderWrapperElem,L,"px"),this.activeSubmenu=i,setTimeout(()=>{i.focusFirstElem(),h&&(e==null||e.deactivate())},this.options.transitionDuration)}getSlideLevel(){return Array.from(this.sliderWrapperElem.querySelectorAll("."+r.active)).length}getTargetMenuFromIdentifier(t){return this.slides.find(i=>i.matches(t))}getTargetMenuDynamically(){const t=location.pathname,i=location.hash,e=this.slides.find(n=>n.matches(i));return this.slides.find(n=>n.matches(t))??e}open(t=!0){const i=this.options.dynamicOpenTarget?this.getTargetMenuDynamically():this.defaultOpenTarget;i&&this.navigateTo(i),this.show(t)}initEventHandlers(){this.menuElem.addEventListener("transitionend",this.onTransitionEnd.bind(this)),this.sliderElem.addEventListener("transitionend",this.onTransitionEnd.bind(this)),this.options.closeOnClickOutside&&document.addEventListener("click",t=>{var i;this.isOpen&&!this.isAnimating&&!this.menuElem.contains(t.target)&&!((i=t.target)!=null&&i.closest("."+r.control))&&this.close()}),this.initKeybindings()}onTransitionEnd(t){t.target!==this.menuElem&&t.target!==this.sliderElem||(this.isAnimating=!1,this.lastAction&&(this.triggerEvent(this.lastAction,!0),this.lastAction=null))}initKeybindings(){document.addEventListener("keydown",t=>{switch(t.key){case this.options.keyClose:this.close();break;case this.options.keyOpen:this.show();break;default:return}t.preventDefault()})}triggerEvent(t,i=!1){this.lastAction=t;const e=`sm.${t}${i?"-after":""}`,l=new CustomEvent(e);this.menuElem.dispatchEvent(l)}markSelectedItem(t){this.menuElem.querySelectorAll("."+r.activeItem).forEach(i=>{i.classList.remove(r.activeItem)}),t.classList.add(r.activeItem)}moveElem(t,i,e="%"){setTimeout(()=>{i.toString().includes(e)||(i+=e),t.style.transform=`translateX(${i})`,this.isAnimating=!0},0)}initMenu(){this.runWithoutAnimation(()=>{switch(this.options.position){case E.Left:Object.assign(this.menuElem.style,{left:0,right:"auto",transform:"translateX(-100%)"});break;default:Object.assign(this.menuElem.style,{left:"auto",right:0});break}});const t=this.menuElem.querySelector("ul");t&&this.slides.push(new p(t,this.options)),this.menuElem.style.display="flex";const i=this.menuElem.querySelector(`.${r.controls}  .${r.control}`);this.menuElem.addEventListener("keydown",e=>{var n,a;(((n=this.activeSubmenu)==null?void 0:n.getClosestNotFoldableSlide())??this.slides[0])&&S(e,((a=this.activeSubmenu)==null?void 0:a.menuElem)??this.menuElem,i)})}runWithoutAnimation(t){const i=[this.menuElem,this.sliderElem];i.forEach(e=>e.style.transition="none"),t(),this.menuElem.offsetHeight,i.forEach(e=>e.style.removeProperty("transition")),this.isAnimating=!1}initSlides(){var i;this.menuElem.querySelectorAll("a").forEach((e,l)=>{if(e.parentElement===null)return;const n=e.parentElement.querySelector("ul");if(!n)return;const a=new p(n,this.options,e);this.slides.push(a)}),this.slides.forEach(e=>{e.appendTo(this.sliderWrapperElem)});const t=this.menuElem.dataset.openTarget??"smdm-sm-no-default-provided";this.defaultOpenTarget=this.getTargetMenuFromIdentifier(t),this.activeSubmenu=((i=this.defaultOpenTarget)==null?void 0:i.activate())??this.slides[0].activate()}}document.addEventListener("click",s=>{if(!(s.target instanceof HTMLElement))return;const t=f=>f.className.includes(r.control)||f.className.includes(r.hasSubMenu),i=t(s.target)?s.target:s.target.closest(`.${r.control}, .${r.hasSubMenu}`);if(!i||!t(i))return;const e=i.getAttribute("data-target"),l=!e||e==="this"?T(i,`.${d}`):document.getElementById(e);if(!l)throw new Error(`Unable to find menu ${e}`);const n=l._slideMenu,a=i.getAttribute("data-action"),c=i.getAttribute("data-arg"),h={false:!1,true:!0,null:null,undefined:void 0},m=Object.keys(h).includes((c==null?void 0:c.toString())??"")?h[c]:c;n&&a&&typeof n[a]=="function"&&(m?n[a](m):n[a]())});window.SlideMenu=F;
